<link rel="import" href="/bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../base/quiz.html">
<link rel="import" href="../base/behaviors/quiz-card.html">
<link rel="import" href="../base/behaviors/can-shuffle.html">
<dom-module id="multi-answer-quiz">
    <template>
        <style>
        :host paper-checkbox {
            padding: 16px 28px;
            width: 100%;
            box-sizing: border-box;
            @apply(--paper-font-subhead);
            position: relative;
            cursor: pointer;
        }
        
        #items {
            padding-top: 32px;
            padding-bottom: 32px;
        }
        </style>
        <quiz-card id="card" question="{{overlay.question}}" combination="{{combination}}">
            <div id="items">
                <template is="dom-repeat" items="{{overlay.options}}" sort="_shuffle" id="list">
                    <paper-checkbox on-tap="_selectionChanged">
                        <mark-up content="{{item}}" pointer-events="1">placeholder</mark-up>
                    </paper-checkbox>
                </template>
            </div>
        </quiz-card>
    </template>
</dom-module>
<script>
'use strict';
(function() {
    Polymer({
        is: 'multi-answer-quiz',
        behaviors: Capira.selectBehaviors({
            core: [Capira.Quiz, Capira.Slang],
            player: Capira.CanShuffle,
            editor: [Capira.EditSingleAnswer, Capira.CanNotShuffle]
        }),
        _compare: function(expected, given) {
            expected = JSON.parse(expected).sort();
            return JSON.stringify(expected) === JSON.stringify(given);
        },
        _valueEquals: function(expected, given) {
            return this.logicslang.compare(expected, given, this._compare);
        },
        _selectionChanged: function() {
            var items = this.$.items.childNodes;
            this.value = [];
            for (var i = 0; i < items.length; i++) {
                var e = items[i];
                if (e.nodeName === 'PAPER-CHECKBOX' && e.checked) {
                    var text = e.querySelector('mark-up').content.trim();
                    this.value.push(this._findOriginalIndex(text));
                }
            }
            this.value.sort();
            console.log('given answer: ', this.value);
            this.fire('answer-changed');
        },
        enterPressed: function() {
            return;
        }
    });
})();
</script>
