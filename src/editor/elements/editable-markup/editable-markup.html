<script>
'use strict';
window.Capira.EditableMarkup = {
    properties: {
        uneditable: {
            value: false
        },
        pointerEvents: {
            value: false
        }
    },
    _edit: function() {
        Polymer.dom(this).textContent = this.content;
    },
    _done: function() {
        if (this.textContent === '' || this.textContent === this.content) {
            // prevent empty markup or rerender if nothing changed
            this._renderContent(this.content);
        } else {
            this.set('content', this.textContent);
        }
    },
    attached: function() {
        if (!this.uneditable) {
            this.contentEditable=true;
            this.style.zIndex = 10;
            this.addEventListener('focus', this._edit.bind(this));
            this.addEventListener('blur', this._done.bind(this));
            if (this.pointerEvents) {
                this.style.pointerEvents = 'all';
            }
            this.addEventListener('click', function(e) {
                e.stopPropagation();
            });
            this.addEventListener('keydown', function(e) {
                e.stopPropagation();
            });
            this.addEventListener('keypress', function(e) {
                e.stopPropagation();
                if (e.keyCode === 13 || e.which === 13) {
                    this.blur();
                    e.preventDefault();
                }
            });

        }
    }
};
</script>
