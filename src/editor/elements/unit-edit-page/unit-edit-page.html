<link rel="import" href="unit-top-bar.html">
<link rel="import" href="unit-right-bar.html">
<dom-module id="unit-edit-page">
    <template>
        <edit-page-layout>
            <template is="dom-if" if="[[unit.video]]">
                <video-player main video="[[unit.video]]"></video-player>
            </template>
            <unit-top-bar top states="default" unit="{{unit}}"></unit-top-bar>
            <unit-right-bar right states="default" unit="{{unit}}"></unit-right-bar>
            <create-overlay-button main id="create"></create-overlay-button>
        </edit-page-layout>
        <overlays-wizard id="wizard"></overlays-wizard>
    </template>
</dom-module>
<script>
'use strict';
(function() {
    Polymer({
        is: 'unit-edit-page',
        behaviors: [Capira.EditPage],
        properties: {
            unit: {
                type: Object,
                notify: true
            }
        },
        listeners: {
            'save-unit': '_save',
            'open-wizard': 'openWizard',
            'overlay-created': 'overlayCreated',
            'overlay-selected': 'overlaySelected'
        },
        _save: function() {
            console.log('save!');
            app.service.updateUnit(app.unit);
        },
        openWizard: function() {
            this.$.wizard.show();
        },
        overlayCreated: function(e) {
            var overlay = e.detail;
            console.log('created', overlay);
            this.push('unit.overlays', overlay);
            setTimeout(function() {
                this.overlaySelected(overlay.id);
            }.bind(this), 300);
        },
        overlaySelected: function(id) {
            id = id.detail ? id.detail : id;
            this.fire('edit-state', 'overlay');
            app.overlays.show(id);
        }
    });
})();
</script>
