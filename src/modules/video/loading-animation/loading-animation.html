<script type="text/javascript">
/**
* The loading animation is a somewhat special component as is is not a Polymer component.
* Also it does not use shadow dom, but lays entirely in the light dom and is already stamped
* into index.html and served immediately at page load. The javascript behaviour contained in this
* file is added afterwards.
*/
(function(window, document) {
	var loadingAnimation = document.getElementById('loading-animation');
	var logoStyle = document.getElementById('logo').style;
	var backgroundStyle = document.getElementById('loading-bg').style;
	var loadingPlayButtonStyle = document.getElementById('loading-play-button').style;

	var domRenderingStart = window.performance? window.performance.timing.domInteractive : 0;
	var firstAnimationCycleTime = 3000;

	if (window.player) {
		setPlayerEventListeners();
	} else {
		window.app.addEventListener('unit-loaded', setPlayerEventListeners);
	}
	
	function setPlayerEventListeners() {
		// perform second animation step when player is ready and first animation cycle finished
		if (player.isReady() && (Date.now()-domRenderingStart) > firstAnimationCycleTime) {
			loadingDone();
		} else {
			player.once('ready', function() {
				if ((Date.now()-domRenderingStart) > firstAnimationCycleTime) {
					loadingDone();
				}
			});
			window.setTimeout(function() {
				if (player.isReady()) {
					loadingDone();
				}
			}, firstAnimationCycleTime - (Date.now()-domRenderingStart));
		}

		// perform third animation step when player started playing
		if (player.hasStarted()) {
			startedPlaying();
		} else {
			player.once('start', startedPlaying);
		}
	}

	/**
	* change to a big play button
	*/
	function loadingDone() {
		logoStyle.opacity = 0;
		backgroundStyle.transform = 'scale(0.6)';
		loadingPlayButtonStyle.opacity = 1;
		loadingPlayButtonStyle.transform = 'translateX(5%) scale(0.75)';
		setTimeout(function() {
			// free system resources
			logoStyle.display = 'none';
			loadingAnimation.classList.remove('logo-will-change');
		}, 200);
		setTimeout(function() {
			// set parameters for next transition
			backgroundStyle.transitionTimingFunction = 'cubic-bezier(0.16, 0.69, 1, 1)';
			backgroundStyle.transitionDuration = '0.4s';
			loadingPlayButtonStyle.transitionTimingFunction = 'linear';
			loadingPlayButtonStyle.transitionDuration = '0.15s';
			loadingPlayButtonStyle.transitionDelay = '0s';
		}, 600);
	}

	/**
	* transition big play button to the play/pause button of the video controls
	*/
	function startedPlaying() {
		var videoControls = document.getElementById('video-player').$['video-controls'];
		var loadingAnimationPosition = loadingAnimation.getBoundingClientRect();
		var loadingAnimationMid = {
			x: loadingAnimationPosition.left + loadingAnimationPosition.width/2,
			y: loadingAnimationPosition.top + loadingAnimationPosition.height/2
		}
		var playPauseButtonPosition = videoControls.getPlayPauseButtonBoundingRect();
		var playPauseButtonMid = {
			x: playPauseButtonPosition.left + playPauseButtonPosition.width/2,
			y: playPauseButtonPosition.top + playPauseButtonPosition.height/2
		};
		var scalingFactor = playPauseButtonPosition.width / loadingAnimationPosition.width;
		var translateX = (playPauseButtonMid.x - loadingAnimationMid.x) / scalingFactor;
		var translateY = (playPauseButtonMid.y - loadingAnimationMid.y) / scalingFactor;
		backgroundStyle.transform = 'scale('+scalingFactor+') translate('+translateX+'px, '+translateY+'px)';
		backgroundStyle.backgroundColor = 'rgba(40, 40, 40, 0.7)';
		backgroundStyle.borderRadius = '0';
		loadingPlayButtonStyle.transform = 'scale(1) translateX(0px)';
		loadingPlayButtonStyle.opacity = 0;
		document.getElementById('loading-pause-button').style.opacity = 1;

		setTimeout(function() {
			var event;
			if (window.Event) {
				event = new Event('animationfinished');
			} else {
				// for IE
				event = document.createEvent('Event');
				event.initEvent('animationfinished', false, false);
			}
			loadingAnimation.dispatchEvent(event);
			// free system resources
			loadingAnimation.parentElement.removeChild(loadingAnimation);
			loadingAnimation.classList.remove('loading-animation-will-change');
		}, 500);
	}
})(window, document);
</script>