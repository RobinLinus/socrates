<link rel="import" href="../../../overlay/overlay.html">
<link rel="import" href="quiz-value.html">
<link rel="import" href="quiz-grade.html">
<link rel="import" href="../quiz-core-sounds/quiz-sounds-behavior.html">
<script>
'use strict';
window.Capira = window.Capira || {};

Capira.QuizImpl = {
    listeners: {
        'quiz-answered': '_quizAnswered',
        'quiz-done': '_done',
        'skipped': '_quizSkipped',
        'answer-changed': '_answerChanged'
    },
    properties: {
        combination: {
            type: Object,
            notify: true
        }
    },

    _show: function() {
        this.value = null;
        if (this.$.card && this.$.card.show) {
            this.$.card.show();
        }

    },

    _answerChanged: function(value) {
        if (value !== undefined && value !== null && value !== '' && this.$.card) {
            this.$.card.wasAnswered();
            //this.combination = null;
        }
    },

    _quizAnswered: function() {
        var combination = this.evaluate();
        if (combination) {
            this.playSound(combination.grade);
        }
        this.set('combination', null);
        this.set('combination', combination);
    },

    _quizSkipped: function(e) {
        e.stopPropagation();
        this.playSound(Capira.Grade.INCORRECT);
        this._done();
    },

    enterPressed: function() {
        if (this.$.card.ui) {
            this.$.card.ui._nextAction();
        } else {
            this.$.card._nextAction();
        }
    }
};
Capira.Quiz = [Capira.Overlay, Capira.QuizSounds, Capira.QuizValue, Capira.QuizImpl];
</script>
